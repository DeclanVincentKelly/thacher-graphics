extends layout

block body
	.container
		#graph
		script(src='/js/d3.min.js')
		link(rel="stylesheet" type="text/css" href="/css/d3-tip-style.css")
		script(src='/js/d3-tip.js')
		script(src='/js/d3-graph.js')
		script(src='/js/jquery.tablesorter.min.js')
		script(type='text/javascript' defer).
			String.prototype.supplant = function (o) {
				return this.replace(/{([^{}]*)}/g,
					function (a, b) {
						var r = o[b];
						return typeof r === 'string' || typeof r === 'number' ? r : a;
					}
				);
			};

			var loadTables = function() {
				var rowString = '<tr class="data-row" href="/graph/users/{ID}"><td>{ID}</td><td>{Name}</td><td>{Gender}</td><td><a href="/graph/class/{Year}">{Year}</a></td></tr>';
				var relTable = $('#class-data > tbody:last');
				for(var i in nodes) {
					relTable.append(rowString.supplant({ID: nodes[i].id, Name: nodes[i].data.name, Gender: nodes[i].data.gender, Year: nodes[i].data.year }))
				}
				$("#class-data").tablesorter();
				$(".data-row").click(function() {
					window.document.location = $(this).attr("href");
				});
			}

			graph('/graph/data/class/#{year}', (4/10), loadTables);
		ul.nav.nav-tabs
			li.active
				a(href="#") #{year}
			for oYear in otherYears
				li
					a(href="/graph/class/#{oYear}") #{oYear}
		table#class-data.table.table-hover
			thead
				tr
					th ID
					th Name
					th Gender
					th Grade
			tbody