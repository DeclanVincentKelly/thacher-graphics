doctype html
html
	head
		meta(charset='utf-8')
		meta(content='IE=edge', http-equiv='X-UA-Compatible')
		meta(content='width=device-width, initial-scale=1', name='viewport')
		title= 'Thacher-Graphics | ' + title
		link(href='/css/bootstrap.min.css', rel='stylesheet')
		link(href='/css/style.css', rel='stylesheet')
		<!--[if lt IE 9 ]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
		script(src='https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js')
		script(src='/js/bootstrap.min.js')
		script(src='/js/helper-functions.js')
		script(src='//cdnjs.cloudflare.com/ajax/libs/select2/3.5.0/select2.min.js')
		link(href='//cdnjs.cloudflare.com/ajax/libs/select2/3.5.0/select2.min.css', rel='stylesheet')
		link(href='/css/select2-bootstrap.css', rel='stylesheet')
		script(src='//cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.7/crossfilter.min.js')
		script(src='//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js')
		script(src='/js/mod-power-select.js')
		script(type='text/javascript').
			function resetPass() {
				$('#passModal').modal({
					keyboard: false,
					backdrop: 'static'
				});

				$('#confirmReset').click(function() {
					$.get('\/change');
					window.location = window.location.origin + "/logout"
				});
			}
	body
		nav.navbar.navbar-default.navbar-static.navbar-fixed-top(role='navigation')
			.container-fluid
				.navbar-header
					button.navbar-toggle(type='button', data-toggle='collapse', data-target='#navbar-collapse')
						span.sr-only Toggle navigation
						span.icon-bar
						span.icon-bar
						span.icon-bar
					a.navbar-brand(href='/') Thacher-Graphics
				if user
					#navbar-collapse.collapse.navbar-collapse
						ul.nav.navbar-nav
							li.dropdown
								a.dropdown-toggle(href='#', data-toggle='dropdown')
									| Graphs
									span.caret
								ul.dropdown-menu(role='menu')
									li
										a(href='/graphs/main') Main Graph
									li
										a(href='/graphs/hive') Hive Graph
						ul.nav.navbar-nav
							li.dropdown
								a.dropdown-toggle(href='#' data-toggle='dropdown')
									| Navigate To
									span.caret
								ul.dropdown-menu(role='menu')
									li
										a(onclick='$("#searchUserModal").modal();') Student Page
									li
										a(onlick='') Class Page
						if user && user.groups.Mod
							ul.nav.navbar-nav
								li.dropdown
									a.dropdown-toggle(href='#', data-toggle='dropdown')
										| Mod Powers
										span.caret
									ul.dropdown-menu(role='menu')
										li
											a(onclick="$('#relModal').modal({keyboard: false});") Add Relationship
										li
											a More to come
						ul.nav.navbar-nav.navbar-right
							li.dropdown
								a.dropdown-toggle(href='#', data-toggle='dropdown')
									| #{user.givenName} #{user.surname}
									span.caret
								ul.dropdown-menu(role='menu')
									li
										a(id='resetPass' href='javascript:{}' onclick='resetPass()') Reset Password	
									li
										a(href='/logout') Logout
		#passModal(role='dialog').modal.fade
			.modal-dialog
				.modal-content
					.modal-header
						h4.modal-title Password Reset
					.modal-body
						p.
							Are you sure you wish to change your password? If so, click the "Change Password" button below and you will be sent an email with further details.
							If not, click "Cancel".
					.modal-footer
						button(type="button")#confirmReset.btn.btn-danger Change Password
						button(type="button" data-dismiss="modal").btn.btn-default Cancel
		#searchUserModal(role='dialog').modal.fade
			.modal-dialog
				.modal-content
					.modal-header
						h4.modal-title Search For User
					.modal-body
						.form-group
							input(type='hidden')#select-user.form-control
						.form-group
							input(type='hidden')#select-grade.form-control
						.form-group
							input(type='hidden')#select-gender.form-control
					.modal-footer
						button(type="button")#confirmSearch.btn.btn-danger.disabled Goto Page
						button(type="button" data-dismiss="modal").btn.btn-default Cancel
		if user && user.groups.Mod
			#relModal(role='dialog').modal.fade
				.modal-dialog
					.modal-content
						.modal-header
							h4#relModalTitle.modal-title Select First Person
						.modal-body
							form(role='form')
								.form-group
									input(type='hidden')#select-user.form-control
								.form-group
									input(type='hidden')#select-grade.form-control
								.form-group
									input(type='hidden')#select-gender.form-control
						.modal-footer
							button(type="button" data-dismiss='modal')#confirmAdd.btn.btn-danger.disabled Select Person
							button(type="button" data-dismiss="modal")#cancelAdd.btn.btn-default Cancel
			#relConfirmModal(role='dialog').modal.fade
				.modal-dialog
					.modal-content
						.modal-header
							h4#relModalTitle.modal-title Relationship Submitted
						.modal-body
							p The relationship you entered has been submitted to the database.
							p If the submitted relationship already exists, no action will be taken.
							p To see the results, please reload your page.
						.modal-footer
							button(type="button" data-dismiss="modal").btn.btn-default Dismiss
			script(type='text/javascript').
				searchUser("#relModal");
				var ids = {a: 0, b: 0}
				var state = 0;
				var user = $('#relModal #select-user');
				$('#relModal #select-user').on('change', function (e) {
					if(!user.val())
						$('#relModal #confirmAdd').addClass('disabled');
					else
						$('#relModal #confirmAdd').removeClass('disabled');
				});

				$('#relModal #confirmAdd').click(function (e) {
					if(state == 0) {
						ids['a'] = +user.val();
						$('#relModal').modal('hide');
						resetAddModal();
						setTimeout(function() {$('#relModal #relModalTitle').text('Select Second Person');}, 250);
						setTimeout(function() {$('#relModal').modal('show');}, 1000);
						state++;
					} else {
						ids['b'] = +user.val();
						$('#relModal').modal('hide');
						resetAddModal();
						
						$('#relConfirmModal').modal();
						state = 0;
						$.post("/data/users", ids);
					}
				});

				$('#relModal #cancelAdd').click(function() {
					ids = {a: 0, b: 0};
					state = 0;
					resetAddModal();
				});

				function resetAddModal() {
					$('#relModal #relModalTitle').text('Select First Person');
					user.select2("val", "");
					user.trigger('change');
					for(var i in searchUser.cross.dimensions)
						searchUser.cross.dimensions[i].filterAll();
				}

				searchUser('#searchUserModal');
				$('#searchUserModal #select-user').on('change', function (e) {
					if(!$('#searchUserModal #select-user').val())
						$('#searchUserModal #confirmSearch').addClass('disabled');
					else
						$('#searchUserModal #confirmSearch').removeClass('disabled');
				});

				$('#searchUserModal #confirmSearch').click(function (e) {
					window.location = "http://" + window.location.host + "/pages/users/" + $('#searchUserModal #select-user').val();
				});

		block body